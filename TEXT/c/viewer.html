<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>A - Viewer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <!-- marked を CDN で読み込み（Markdown → HTML） -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="container">
    <header class="site">
      <h1>A セクション</h1>
      <nav>
        <a href="../index.html">トップ</a> |
        <a href="a.index.html">目次</a>
      </nav>
    </header>

    <main id="main">
      <div id="md-content">読み込み中...</div>
    </main>

    <footer style="margin-top:2rem;color:#666;font-size:.9rem">
      A セクション
    </footer>
  </div>

  <script>
    // URLパラメータ 'file' を見てローカルの md を読み込む。
    // 例: a/viewer.html?file=1.md
    function qs(name){
      const u = new URL(location.href);
      return u.searchParams.get(name);
    }
    const file = qs('file') || '1.md'; // デフォルトは 1.md
    const container = document.getElementById('md-content');

    fetch(file)
      .then(res => {
        if(!res.ok) throw new Error('ファイルが見つかりません: ' + file);
        return res.text();
      })
      .then(md => {
        // マークダウンを HTML に変換（marked を使用）
        container.innerHTML = marked.parse(md);
        // 相対リンクの処理（例えば他の md へのリンクを viewer に繋ぐ）
        // a[href$=".md"] を viewer に繋げる
        Array.from(container.querySelectorAll('a[href$=".md"]')).forEach(a=>{
          const href = a.getAttribute('href');
          a.setAttribute('href', 'viewer.html?file=' + encodeURIComponent(href));
        });
      })
      .catch(err => {
        container.textContent = err.message;
      });

    // 簡単な Cookie 表示（index と同じ cookie 名）
    function getCookie(name){
      const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
      return v ? decodeURIComponent(v.pop()) : '';
    }
    const name = getCookie('visitorName');
    if(name){
      const h = document.querySelector('header.site h1');
      if(h) h.textContent = `A セクション — ようこそ ${name} さん`;
    }
  </script>
</body>
</html>